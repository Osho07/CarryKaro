<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CarryKaro - Cart</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Include header -->
  <div id="header-placeholder"></div>

  <div class="container">
    <h2>Your Cart</h2>
    <div id="cart-items"></div>
    <button id="proceed-btn">Proceed to Checkout</button>
  </div>

  <script>
    // Load header.html into header-placeholder div
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-placeholder').innerHTML = data;
      });

    async function loadCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '{}');
      const cartItemsDiv = document.getElementById('cart-items');
      cartItemsDiv.innerHTML = '';
      if (Object.keys(cart).length === 0) {
        cartItemsDiv.innerHTML = '<p>Your cart is empty.</p>';
        document.getElementById('proceed-btn').style.display = 'none';
        return;
      }
      try {
        const res = await fetch('http://localhost:5000/api/products');
        const products = await res.json();
        let total = 0;
        Object.entries(cart).forEach(([productId, qty]) => {
          const product = products.find(p => p._id === productId);
          if (product) {
            total += product.price * qty;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'product-card';
            itemDiv.innerHTML = '<h3>' + product.name + '</h3>' +
              '<p>Price: ₹' + product.price + '</p>' +
              '<p>Quantity: ' + qty + '</p>' +
              '<button onclick="removeFromCart(\'' + productId + '\')">Remove</button>';
            cartItemsDiv.appendChild(itemDiv);
          }
        });
        const totalDiv = document.createElement('div');
        totalDiv.innerHTML = '<h3>Total: ₹' + total + '</h3>';
        cartItemsDiv.appendChild(totalDiv);
      } catch (err) {
        alert('Failed to load cart items');
      }
    }

    function removeFromCart(productId) {
      let cart = JSON.parse(localStorage.getItem('cart') || '{}');
      if (cart[productId]) {
        delete cart[productId];
        localStorage.setItem('cart', JSON.stringify(cart));
        loadCart();
      }
    }

    document.getElementById('proceed-btn').addEventListener('click', () => {
      window.location.href = 'checkout.html';
    });

    loadCart();
  </script>
</body>
</html>
